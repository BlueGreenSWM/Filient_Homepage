# 규칙 실행

규칙 실행은 설정한 조건과 액션에 따라 파일을 자동으로 정리하는 과정입니다. 이 가이드에서는 규칙 실행 방법과 모니터링 방법을 설명합니다.

## 실행 방법

### 수동 실행

#### 단일 규칙 실행
1. **규칙 선택**
   - 폴더 선택
   - 규칙 목록에서 실행할 규칙 선택

2. **시험 실행 (권장)**
   - "시험 실행" 버튼 클릭
   - 영향받을 파일 미리보기
   - 예상 결과 확인
   - 문제 없으면 "실행" 진행

3. **실제 실행**
   - "실행" 버튼 클릭
   - 또는 규칙 우클릭 > "실행"
   - 진행 상황 모니터링

#### 여러 규칙 실행
1. **폴더 선택**
   - 실행할 규칙들이 있는 폴더 선택

2. **모든 규칙 실행**
   - "모든 규칙 실행" 버튼 클릭
   - 우선순위 순서로 실행됨
   - 각 규칙의 진행 상황 표시

3. **선택 규칙 실행**
   - Cmd 클릭으로 여러 규칙 선택
   - "선택 항목 실행" 클릭
   - 선택한 순서대로 실행

### 자동 실행

#### 스케줄러 설정
자세한 내용은 [규칙 스케줄러](../advanced/03-scheduler.md) 참고

**간단 설정**:
1. 규칙 선택
2. "스케줄 설정" 클릭
3. 실행 주기 선택:
   - 매일 특정 시간
   - 매주 특정 요일
   - 매월 특정 날짜
4. 저장

#### 폴더 감시 (향후 기능)
폴더에 파일이 추가되면 자동으로 규칙 실행 (개발 예정)

## 실행 과정

### 1. 파일 스캔
```
폴더 검색 시작
├─ 루트 폴더 스캔
├─ 하위 폴더 스캔 (옵션에 따라)
└─ 파일 목록 수집
```

**스캔 옵션**:
- **하위 폴더 포함**: 모든 하위 폴더까지 검색
- **숨김 파일 포함**: .으로 시작하는 파일 포함
- **시스템 파일 제외**: macOS 시스템 파일 건너뛰기

### 2. 조건 평가
각 파일에 대해 규칙의 조건을 확인합니다.

```
파일 검사
├─ 조건 1 확인 (예: 확장자 = pdf)
├─ 조건 2 확인 (예: 크기 > 1MB)
├─ 조건 3 확인 (예: 수정일 < 30일 전)
└─ 모든 조건 만족 시 → 액션 실행 대상
```

**조건 로직**:
- **AND**: 모든 조건을 만족해야 함 (기본)
- **OR**: 조건 그룹 중 하나만 만족하면 됨

### 3. 액션 실행
조건에 맞는 파일에 액션을 적용합니다.

```
액션 실행
├─ 액션 1: 파일 이동
├─ 액션 2: 태그 추가
└─ 액션 3: 이름 변경
```

**실행 순서**:
- 규칙에 정의된 순서대로
- 이전 액션의 결과가 다음 액션에 영향

### 4. 결과 기록
모든 작업은 히스토리에 기록됩니다.

```
히스토리 기록
├─ 폴더 히스토리 (실행 단위)
├─ 규칙 히스토리 (규칙별)
├─ 파일 히스토리 (파일별)
└─ 액션 히스토리 (액션별)
```

## 실행 모드

### 시험 실행 (Dry Run)
실제로 파일을 변경하지 않고 결과를 미리 확인합니다.

**표시 정보**:
- 영향받을 파일 목록
- 각 파일에 적용될 액션
- 예상 결과 위치
- 잠재적 충돌 경고

**활용**:
- 규칙을 처음 만들었을 때
- 중요한 파일을 다룰 때
- 복잡한 조건을 테스트할 때

### 일반 실행
실제로 파일을 변경하며 실행합니다.

**특징**:
- 모든 변경 사항 기록
- 롤백 가능
- 진행 상황 실시간 표시
- 오류 발생 시 중단 또는 계속 선택 가능

### 승인 필요 모드
실행 전 사용자 승인을 요청합니다.

**승인 프로세스**:
1. 규칙 실행 요청
2. 승인 큐에 추가
3. 사용자 검토
   - 영향받을 파일 확인
   - 각 액션 검토
4. 승인 또는 거부
5. 승인 시 실행

**사용 사례**:
- 삭제 액션이 포함된 규칙
- 중요한 파일을 다루는 규칙
- 처음 사용하는 규칙

자세한 내용은 [알림 및 승인](../advanced/02-notifications.md) 참고

## 실행 진행 상황

### 진행률 표시
실행 중 실시간 정보를 표시합니다.

```
규칙 실행 중: PDF 파일 정리
━━━━━━━━━━━━━━━━━━━━━━━━━ 65%

처리 중: document.pdf (15/23)
성공: 14 | 실패: 0 | 건너뜀: 1

예상 남은 시간: 00:30
```

**표시 정보**:
- 진행률 (백분율)
- 현재 처리 중인 파일
- 처리된 파일 수 / 전체 파일 수
- 성공/실패/건너뜀 통계
- 예상 남은 시간

### 실시간 로그
실행 중 상세 로그를 실시간으로 확인할 수 있습니다.

```
[14:32:10] 파일 스캔 시작
[14:32:11] 23개 파일 발견
[14:32:11] 조건 평가 시작
[14:32:12] 15개 파일 조건 만족
[14:32:12] 액션 실행 시작
[14:32:13] ✓ document1.pdf 이동 완료
[14:32:14] ✓ document2.pdf 이동 완료
[14:32:15] ⚠ document3.pdf 건너뜀 (이미 존재)
```

**로그 레벨**:
- **정보**: 일반 진행 상황
- **성공**: 작업 완료
- **경고**: 건너뛴 파일, 충돌
- **오류**: 실패한 작업

### 실행 제어

**일시 정지**:
- "일시 정지" 버튼 클릭
- 현재 파일 처리 완료 후 정지
- "재개"로 계속 진행

**취소**:
- "취소" 버튼 클릭
- 즉시 실행 중단
- 이미 처리된 파일은 유지
- 히스토리에 "취소됨"으로 기록

## 실행 결과

### 완료 요약
실행 완료 후 요약 정보를 표시합니다.

```
실행 완료: PDF 파일 정리

총 처리: 23개 파일
━━━━━━━━━━━━━━━━━━━━━━━━━

✓ 성공: 20개
✗ 실패: 2개
⊘ 건너뜀: 1개

실행 시간: 00:02:15
```

**상세 결과**:
- 각 상태별 파일 목록
- 실패한 파일의 오류 원인
- 건너뛴 파일의 이유
- 총 실행 시간

### 오류 처리

**오류 발생 시 옵션**:
1. **계속**: 오류 무시하고 다음 파일 처리
2. **건너뛰기**: 해당 파일 건너뛰고 계속
3. **중단**: 실행 즉시 중단
4. **롤백**: 이미 처리된 작업 되돌리기

**일반적인 오류**:
- **권한 오류**: 파일 접근 권한 없음
  - 해결: 전체 디스크 접근 권한 확인
- **파일 없음**: 파일이 이미 삭제됨
  - 해결: 다른 프로그램이 파일 수정 중인지 확인
- **디스크 공간 부족**: 대상 디스크 공간 부족
  - 해결: 디스크 공간 확보
- **충돌**: 동일 이름 파일이 이미 존재
  - 해결: 충돌 처리 옵션 변경

## 성능 최적화

### 대용량 파일 처리
많은 수의 파일을 다룰 때 성능을 최적화하는 방법입니다.

**배치 처리**:
- 파일을 그룹으로 나누어 처리
- 기본: 100개 파일씩
- 설정에서 조정 가능

**병렬 처리**:
- 여러 파일을 동시에 처리 (안전한 액션만)
- 복사, 태그 추가 등
- 이동, 삭제는 순차 처리 (데이터 안전)

**메모리 관리**:
- 대용량 파일은 스트리밍 방식으로 처리
- 썸네일 생성 최소화
- 미리보기 제한

### 스캔 최적화

**제외 패턴**:
불필요한 파일/폴더를 스캔에서 제외합니다.

```
제외할 폴더:
- .git
- node_modules
- .DS_Store
- Thumbs.db
```

**증분 스캔** (향후 기능):
- 이전 실행 이후 변경된 파일만 검사
- 스캔 시간 단축
- 대용량 폴더에 유용

### 조건 최적화

**빠른 조건 우선**:
- 확장자, 크기 등 빠른 조건을 먼저 배치
- 정규식, 내용 검색 등은 나중에

**불필요한 조건 제거**:
- 중복되는 조건 정리
- 결과에 영향 없는 조건 삭제

## 모범 사례

### 실행 전 준비
- **테스트 먼저**: 항상 시험 실행으로 확인
- **백업**: 중요 파일은 백업 후 실행
- **권한 확인**: 전체 디스크 접근 권한 설정
- **충분한 공간**: 대상 디스크 공간 확인

### 실행 중 모니터링
- **로그 확인**: 오류 발생 즉시 파악
- **진행 상황 추적**: 예상과 다른 동작 발견
- **리소스 모니터**: CPU, 메모리 사용량 체크

### 실행 후 검증
- **결과 확인**: 파일이 올바른 위치로 이동했는지
- **오류 검토**: 실패한 파일의 원인 파악
- **히스토리 저장**: 나중에 참고할 수 있도록

### 안전한 실행
- **점진적 적용**: 작은 범위부터 시작
- **승인 모드 활용**: 중요한 작업은 승인 필요 설정
- **롤백 가능성**: 언제든 되돌릴 수 있도록
- **정기 검토**: 자동 실행 규칙 주기적 확인

## 문제 해결

### 규칙이 실행되지 않음
**확인 사항**:
- 규칙이 활성화되어 있는지
- 조건에 맞는 파일이 있는지
- 폴더 경로가 올바른지
- 권한 문제는 없는지

### 일부 파일만 처리됨
**원인**:
- 조건이 너무 엄격함
- 파일이 다른 프로그램에서 사용 중
- 권한 없는 파일 존재

**해결**:
- 시험 실행으로 조건 확인
- 파일 사용 중인 프로그램 종료
- 권한이 필요한 파일 제외

### 실행이 느림
**원인**:
- 파일 수가 너무 많음
- 복잡한 조건 사용
- 대용량 파일 처리
- 네트워크 드라이브 사용

**해결**:
- 배치 크기 조정
- 조건 단순화
- 제외 패턴 활용
- 로컬 디스크 사용

### 충돌이 자주 발생
**원인**:
- 중복 파일명
- 이전 실행 결과

**해결**:
- 충돌 처리를 "이름 변경"으로 설정
- 실행 전 대상 폴더 정리
- 고유한 이름 패턴 사용

## FAQ

**Q: 실행을 취소하면 어떻게 되나요?**
- 이미 처리된 파일은 그대로 유지됩니다.
- 히스토리에서 롤백으로 되돌릴 수 있습니다.

**Q: 동일한 규칙을 여러 번 실행하면?**
- 매번 새로운 히스토리 항목이 생성됩니다.
- 이미 처리된 파일은 조건에 맞지 않아 건너뛸 수 있습니다.

**Q: 여러 규칙이 같은 파일을 처리하면?**
- 우선순위 순서대로 실행됩니다.
- 이전 규칙의 결과가 다음 규칙에 영향을 줄 수 있습니다.
- 예: 규칙 1로 파일 이동 후, 규칙 2는 새 위치에서 파일을 찾지 못함

**Q: 스케줄 실행 중 Mac을 종료하면?**
- 실행되지 않습니다.
- 다음 스케줄 시간에 실행됩니다.
- Mac이 켜져 있어야 스케줄 실행이 작동합니다.

**Q: 실행 중 오류가 발생하면 자동으로 롤백되나요?**
- 아니오. 자동 롤백되지 않습니다.
- 오류 발생 시 사용자가 선택할 수 있습니다:
  - 계속, 건너뛰기, 중단, 수동 롤백

---

[목차로 돌아가기](../README.md) | [다음: 히스토리 및 롤백](./05-history-rollback.md)
