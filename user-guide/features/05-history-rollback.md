# 히스토리 및 롤백

Filient는 모든 규칙 실행을 기록하고, 언제든 이전 상태로 되돌릴 수 있는 롤백 기능을 제공합니다. 실수로 파일을 잘못 정리했을 때 안전하게 복구할 수 있습니다.

## 히스토리 시스템

### 4단계 히스토리 구조

Filient는 세밀한 추적을 위해 4단계 계층 구조로 히스토리를 기록합니다.

```
폴더 히스토리 (실행 단위)
└─ 규칙 히스토리 (규칙별)
   └─ 파일 히스토리 (파일별)
      └─ 액션 히스토리 (액션별)
```

#### 1단계: 폴더 히스토리
전체 실행 세션을 기록합니다.

**기록 정보**:
- 실행 시작/종료 시간
- 처리된 규칙 수
- 전체 파일 수
- 성공/실패/건너뜀 통계
- 실행 상태 (완료, 취소, 실패)

**예시**:
```
2024-01-15 14:30:00
다운로드 폴더 정리
규칙 3개 | 파일 45개
성공 42 | 실패 1 | 건너뜀 2
```

#### 2단계: 규칙 히스토리
각 규칙의 실행 결과를 기록합니다.

**기록 정보**:
- 규칙 이름 및 설정
- 처리된 파일 수
- 규칙별 통계
- 실행 시간

**예시**:
```
규칙: PDF 파일 정리
파일 15개 처리
성공 14 | 실패 0 | 건너뜀 1
실행 시간: 00:00:45
```

#### 3단계: 파일 히스토리
개별 파일에 대한 작업을 기록합니다.

**기록 정보**:
- 파일 경로 (원본)
- 파일 이름
- 파일 크기
- 적용된 액션 목록
- 최종 상태

**예시**:
```
파일: document.pdf
원본: ~/Downloads/document.pdf
크기: 2.3 MB
액션 2개 적용
상태: 완료
```

#### 4단계: 액션 히스토리
각 액션의 세부 정보를 기록합니다.

**기록 정보**:
- 액션 유형
- 이전 값 (Before)
- 이후 값 (After)
- 실행 결과
- 오류 메시지 (있는 경우)

**예시**:
```
액션: 이동
이전: ~/Downloads/document.pdf
이후: ~/Documents/PDF/document.pdf
상태: 성공
```

### 히스토리 조회

#### 히스토리 페이지
메인 메뉴에서 "히스토리" 선택

**보기 옵션**:
- **목록 뷰**: 시간순 나열
- **폴더별 뷰**: 폴더로 그룹화
- **규칙별 뷰**: 규칙으로 그룹화
- **타임라인 뷰**: 시각적 타임라인

#### 필터링

**날짜 필터**:
- 오늘
- 최근 7일
- 최근 30일
- 사용자 지정 기간

**상태 필터**:
- 완료
- 실패
- 취소
- 부분 완료

**폴더 필터**:
- 전체 폴더
- 특정 폴더만

**규칙 필터**:
- 전체 규칙
- 특정 규칙만

#### 검색

**검색 기준**:
- 파일 이름
- 폴더 이름
- 규칙 이름
- 날짜 범위

**검색 예시**:
```
파일명: "report" → report가 포함된 모든 파일
폴더: "Downloads" → 다운로드 폴더의 히스토리만
규칙: "PDF" → PDF 관련 규칙의 히스토리만
```

### 상세 정보 보기

히스토리 항목을 클릭하면 상세 정보를 확인할 수 있습니다.

**폴더 히스토리 상세**:
```
실행 요약
━━━━━━━━━━━━━━━━━━━━━━━━━
실행 시간: 2024-01-15 14:30:00
폴더: ~/Downloads
실행 방식: 수동

규칙 실행 결과
━━━━━━━━━━━━━━━━━━━━━━━━━
✓ PDF 파일 정리 (15개 파일)
✓ 이미지 분류 (28개 파일)
✗ 오래된 파일 삭제 (2개 실패)

전체 통계
━━━━━━━━━━━━━━━━━━━━━━━━━
총 파일: 45개
성공: 42개
실패: 1개
건너뜀: 2개

실행 시간: 00:02:15
```

**파일 히스토리 상세**:
```
파일 정보
━━━━━━━━━━━━━━━━━━━━━━━━━
파일명: document.pdf
원본 위치: ~/Downloads
크기: 2.3 MB
수정일: 2024-01-10 09:15:00

적용된 액션
━━━━━━━━━━━━━━━━━━━━━━━━━
1. 이동
   ~/Downloads/document.pdf
   → ~/Documents/PDF/document.pdf

2. 태그 추가
   태그: 문서, 중요

최종 상태
━━━━━━━━━━━━━━━━━━━━━━━━━
위치: ~/Documents/PDF/document.pdf
상태: 완료
```

## 롤백 기능

### 롤백이란?

롤백은 규칙 실행으로 변경된 파일들을 원래 상태로 되돌리는 기능입니다.

**복원되는 것**:
- 파일 위치 (이동, 복사)
- 파일 이름 (이름 변경)
- 파일 태그
- 파일 주석

**복원되지 않는 것**:
- 삭제된 파일 (휴지통에서 복원 필요)
- 영구 삭제된 파일 (복원 불가)
- 외부 프로그램으로 수정된 파일

### 롤백 실행

#### 전체 실행 롤백
폴더 히스토리 단위로 전체 롤백

1. **히스토리 선택**
   - 롤백할 실행 히스토리 선택
   - 상세 정보 확인

2. **롤백 미리보기**
   - "롤백" 버튼 클릭
   - 복원될 파일 목록 확인
   - 예상 결과 확인

3. **롤백 실행**
   - "롤백 실행" 클릭
   - 진행 상황 모니터링
   - 완료 확인

#### 선택적 롤백
특정 파일만 롤백

1. **파일 선택**
   - 히스토리 상세에서 파일 목록 보기
   - 롤백할 파일 선택 (Cmd 클릭으로 다중 선택)

2. **롤백 옵션**
   - "선택 항목 롤백" 클릭
   - 선택한 파일의 변경 사항 확인

3. **실행**
   - 확인 후 롤백 실행

#### 규칙별 롤백
특정 규칙의 결과만 롤백

1. **규칙 히스토리 선택**
   - 폴더 히스토리에서 규칙 선택
   - 해당 규칙의 파일 목록 확인

2. **롤백**
   - "이 규칙 롤백" 클릭
   - 해당 규칙으로 처리된 파일만 복원

### 롤백 제한사항

#### 시간 제한
**기본 설정**:
- 롤백 가능 기간: 30일
- 설정에서 변경 가능 (7일 ~ 90일)

**이유**:
- 디스크 공간 관리
- 파일 시스템 변화 추적 한계

#### 파일 상태

**롤백 불가능한 경우**:
- 원본 위치가 삭제됨
- 대상 위치에 동일 이름 파일 존재
- 파일 권한 변경
- 파일이 외부에서 수정됨

**경고 표시**:
```
⚠ 롤백 불가능한 파일 3개
- document.pdf (대상 위치에 동일 파일 존재)
- image.jpg (원본 폴더 삭제됨)
- archive.zip (파일 외부 수정됨)
```

### 롤백 진행 상황

```
롤백 진행 중
━━━━━━━━━━━━━━━━━━━━━━━━━ 60%

복원 중: document.pdf (12/20)
성공: 11 | 실패: 0 | 건너뜀: 1

예상 남은 시간: 00:15
```

**로그 예시**:
```
[15:20:00] 롤백 시작
[15:20:01] 20개 파일 복원 예정
[15:20:02] ✓ document1.pdf 복원 완료
[15:20:03] ✓ document2.pdf 복원 완료
[15:20:04] ⚠ document3.pdf 건너뜀 (충돌)
[15:20:15] 롤백 완료: 성공 18, 건너뜀 2
```

### 롤백 결과

**완료 요약**:
```
롤백 완료

총 복원: 20개 파일
━━━━━━━━━━━━━━━━━━━━━━━━━

✓ 성공: 18개
⊘ 건너뜀: 2개

복원 시간: 00:00:45
```

**실패 파일 처리**:
- 실패 사유 확인
- 수동 복원 가이드 제공
- 지원 팀에 문의 가능

## 히스토리 관리

### 히스토리 삭제

#### 개별 삭제
1. 히스토리 항목 선택
2. "삭제" 버튼 클릭
3. 확인 대화상자
4. 히스토리 제거 (롤백 불가능해짐)

#### 일괄 삭제
오래된 히스토리를 자동 또는 수동으로 정리

**자동 삭제**:
```
설정 > 히스토리 관리
- 자동 삭제 활성화
- 보관 기간: 30일
- 디스크 공간 제한: 1GB
```

**수동 삭제**:
```
히스토리 페이지 > 정리
- 30일 이전 삭제
- 실패한 실행만 삭제
- 선택 항목 삭제
```

### 히스토리 내보내기

히스토리를 파일로 저장하여 보관하거나 분석할 수 있습니다.

**내보내기 형식**:
- **CSV**: 표 형식, Excel에서 열기 가능
- **JSON**: 프로그래밍 분석용
- **PDF**: 보고서 형식

**내보내기 단계**:
1. 히스토리 선택
2. "내보내기" 클릭
3. 형식 선택
4. 저장 위치 선택
5. 파일 생성

**내보낸 데이터**:
- 실행 요약
- 규칙 정보
- 파일 목록
- 액션 상세
- 통계 및 그래프 (PDF)

### 히스토리 통계

**전체 통계**:
```
히스토리 통계
━━━━━━━━━━━━━━━━━━━━━━━━━
총 실행 횟수: 156회
처리된 파일: 2,345개
성공률: 98.5%

가장 많이 사용된 규칙:
1. PDF 파일 정리 (45회)
2. 이미지 분류 (38회)
3. 오래된 파일 삭제 (32회)

폴더별 실행 횟수:
1. ~/Downloads (78회)
2. ~/Desktop (45회)
3. ~/Documents (33회)
```

**기간별 통계**:
- 일별 실행 추이 그래프
- 시간대별 실행 패턴
- 성공률 변화

## 실전 활용

### 안전한 규칙 테스트

1. **새 규칙 만들기**
   - 조건과 액션 설정

2. **소규모 테스트**
   - 일부 파일에만 적용
   - 실행 및 결과 확인

3. **문제 발견 시**
   - 즉시 롤백
   - 규칙 수정
   - 재테스트

4. **성공 시**
   - 전체 폴더에 적용

### 대규모 정리 작업

1. **백업 먼저**
   - 중요 파일 백업

2. **단계별 실행**
   - 여러 규칙을 한 번에 실행하지 말고
   - 하나씩 실행하고 확인

3. **히스토리 확인**
   - 각 단계 결과 검토
   - 문제 발견 시 롤백

4. **최종 검증**
   - 모든 파일이 올바른 위치에 있는지 확인

### 정기적 정리

1. **스케줄 설정**
   - 매일/매주 자동 실행

2. **히스토리 모니터링**
   - 실행 결과 주기적 확인
   - 실패 패턴 분석

3. **규칙 최적화**
   - 히스토리 통계 기반 개선
   - 불필요한 규칙 제거

## 모범 사례

### 롤백 전략
- **즉시 확인**: 실행 후 바로 결과 확인
- **빠른 롤백**: 문제 발견 시 즉시 롤백
- **부분 롤백**: 전체가 아닌 문제 파일만 롤백
- **재실행**: 롤백 후 규칙 수정하여 재실행

### 히스토리 활용
- **패턴 분석**: 자주 실패하는 규칙 개선
- **통계 활용**: 사용 빈도 기반 우선순위 조정
- **문서화**: 중요 실행은 메모 추가
- **정기 검토**: 월간 히스토리 리뷰

### 디스크 공간 관리
- **자동 정리**: 오래된 히스토리 자동 삭제 활성화
- **선택적 보관**: 중요 히스토리만 보관
- **내보내기**: 장기 보관 필요 시 내보내기 후 삭제
- **압축**: 큰 히스토리는 압축하여 보관

## 문제 해결

### 롤백이 실패함

**원인**:
- 원본 위치가 더 이상 존재하지 않음
- 대상 위치에 동일 파일 존재
- 권한 문제

**해결**:
- 원본 폴더 먼저 생성
- 충돌 파일 이름 변경 또는 이동
- 권한 확인 및 조정

### 히스토리가 너무 많음

**해결**:
- 오래된 항목 일괄 삭제
- 자동 정리 기간 단축
- 디스크 공간 제한 설정

### 롤백 후 파일이 이상함

**원인**:
- 롤백 후 파일이 외부에서 수정됨
- 부분 롤백으로 일부만 복원됨

**해결**:
- 전체 롤백 재실행
- 히스토리 상세 확인
- 필요시 수동 복원

## FAQ

**Q: 롤백하면 모든 것이 완전히 원래대로 되나요?**
- 파일 위치, 이름, 태그, 주석은 복원됩니다.
- 삭제된 파일은 휴지통에서 복원해야 합니다.
- 외부에서 수정된 파일 내용은 복원되지 않습니다.

**Q: 히스토리를 삭제하면 파일도 삭제되나요?**
- 아니오. 히스토리만 삭제되고 파일은 그대로입니다.
- 단, 삭제 후에는 롤백할 수 없습니다.

**Q: 오래된 실행도 롤백할 수 있나요?**
- 기본 30일 이내 실행만 롤백 가능합니다.
- 설정에서 최대 90일까지 연장 가능합니다.

**Q: 롤백 중 오류가 발생하면?**
- 성공한 파일은 복원됩니다.
- 실패한 파일 목록과 사유를 확인할 수 있습니다.
- 실패한 파일은 수동으로 복원하거나 재시도할 수 있습니다.

**Q: 히스토리가 많으면 성능에 영향을 주나요?**
- 매우 많은 히스토리(수천 건 이상)가 있으면 조회가 느려질 수 있습니다.
- 정기적으로 오래된 히스토리를 삭제하면 성능이 개선됩니다.

---

[목차로 돌아가기](../README.md) | [다음: 직접 작업](../advanced/01-direct-action.md)
